import{createComponent as e}from"solid-js/web";import{createStore as t,produce as n}from"solid-js/store";import{createContext as l,on as o,useContext as i,createRoot as a,createEffect as r,onCleanup as d}from"solid-js";var v=l({elements:{},closeSymbol:Symbol("close"),insertElement:()=>{},onDeactivated:()=>{},onActivated:()=>{},removeAliveElement:()=>{},setElement:()=>{},setCurrentComponentId:()=>{}});function c(l){var[i,a]=t();let r=Symbol("close"),d=r,c=new Map,s=new Map;var u=e=>{var t;if(Reflect.has(i,e)){var n=null===(t=i[e])||void 0===t?void 0:t.children;null==n||n.forEach((t=>t!==e&&u(t))),a((t=>{var n,l;return t[e].onDeactivated=null,t[e].component=null,null===(l=(n=t[e]).dispose)||void 0===l||l.call(n),t[e].dispose=null,t[e].onActivated=null,t[e].onDeactivated=null,t[e].id="",t[e].children=null,t[e]=null,delete t[e],t}))}},m=(e,t)=>{if(d!==r&&t){var n={onActivated:c,onDeactivated:s}[e],l=n.get(d)||new Set;l.size<100&&l.add(o([],t))&&n.set(d,l)}};return e(v.Provider,{value:{elements:i,closeSymbol:r,onActivated:e=>{m("onActivated",e)},onDeactivated:e=>{m("onDeactivated",e)},insertElement:e=>{let t=e.id,n=c.get(t),l=s.get(t);c.delete(t),s.delete(t),a([t],Object.assign(Object.assign(Object.assign({},i[t]),e),{onActivated:n,onDeactivated:l}))},setElement:(e,t,l)=>{Reflect.has(i,e)&&a(n((n=>{n[e][t]=l})))},removeAliveElement:e=>{if(null==e)for(const e of Object.values(i))u(e.id);else u(e)},setCurrentComponentId:e=>{d=e}},get children(){return l.children}})}function s(t,n,l){var{elements:o,closeSymbol:c,insertElement:s,setCurrentComponentId:u}=i(v);return Reflect.has(o,n)||(u(n),s({id:n,children:Array.isArray(l)?new Set(l):null}),a((l=>{var i;s({id:n,dispose:l,component:e(t,{}),onDeactivated:null,onActivated:null});var a=null===(i=Object.values(o).find((e=>{var t;return null===(t=e.children)||void 0===t?void 0:t.has(n)})))||void 0===i?void 0:i.id;a&&u(a)}))),r((()=>{var e;null===(e=o[n].onActivated)||void 0===e||e.forEach((e=>e()))})),d((()=>{var e;u(c),null===(e=o[n].onDeactivated)||void 0===e||e.forEach((e=>e()))})),o[n].component}function u(){var{onActivated:e,onDeactivated:t,removeAliveElement:n}=i(v);return{onActivated:e,onDeactivated:t,removeAliveElement:n}}function m(e){var{onActivated:t}=u();t(e)}function f(e){var{onDeactivated:t}=u();t(e)}export{c as AliveProvider,s as AliveTransfer,m as onActivated,f as onDeactivated,u as useAlive};
