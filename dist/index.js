import{createComponent as e}from"solid-js/web";import{createContext as t,useContext as n,createRoot as r,getOwner as i,onCleanup as o,runWithOwner as l,createEffect as s,untrack as d}from"solid-js";import{produce as u,createStore as v}from"solid-js/store";const a=Symbol("currentId"),c=Symbol("setActiveCb");var m=t({elements:{},setElements:()=>{},setActiveCb:()=>{},aliveIds:()=>{}});const f=t({[a]:void 0,[c]:()=>{}});function A(t,s,d){return function(v){var A,y,h=n(m);return(null===(A=h.aliveIds())||void 0===A?void 0:A.includes(s))?(h.elements[s]?null===(y=h.elements[s].onActivated)||void 0===y||y.forEach((e=>e())):(h.setElements({[s]:{id:s,subsets:Array.isArray(d)?d:null}}),r((n=>{h.setElements(u((r=>{r[s].dispose=n,r[s].id=s,r[s].owner=i(),r[s].element=e(f.Provider,{get value(){return{[a]:s,[c]:h.setActiveCb}},get children(){return t(v)}})})))}))),o((()=>{var e;null===(e=h.elements[s].onDeactivated)||void 0===e||e.forEach((e=>e()))})),h.elements[s].owner&&l(h.elements[s].owner,(()=>h.elements[s].element))):t(v)}}function y(t){const[n,r]=v(),i=e=>{var t,o,l;if(Array.isArray(e))for(var s of e)i(null===(t=n[s])||void 0===t?void 0:t.subsets),null===(l=null===(o=n[s])||void 0===o?void 0:o.dispose)||void 0===l||l.call(o),r({[s]:void 0})};return s((e=>{var n=Array.isArray(t.include)?t.include:[];if(e.length>n.length){var r=new Set(n);i(e.filter((e=>!r.has(e))))}return n}),Array.isArray(t.include)?t.include:[]),e(m.Provider,{value:{elements:n,setElements:r,setActiveCb:(e,t,n,i)=>{r(u((r=>{r[e][t]?r[e][t][i](n):"add"===i&&(r[e][t]=new Set([n]))})))},aliveIds:()=>t.include},get children(){return t.children}})}function h(e,t){d((()=>{var r=n(f),i=r[a];i&&(r[c](i,e,t,"add"),"onActivated"===e&&s((()=>{!function(e){"undefined"!=typeof Promise&&"function"==typeof Promise.prototype.then?Promise.resolve().then(e):setTimeout(e)}(t)})),o((()=>{r[c](i,e,t,"delete"),t=null})))}))}function p(e){h("onActivated",e)}function b(e){h("onDeactivated",e)}export{y as AliveProvider,A as aliveTransfer,p as onActivated,b as onDeactivated};
